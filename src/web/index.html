<!DOCTYPE html>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EOS connect board</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.cdnfonts.com/css/seven-segment" rel="stylesheet">

</head>

<body>
    <div id="overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); color: white; display: flex; justify-content: center; align-items: center; z-index: 1000;">
        <div style="text-align: center; padding: 2em; position: relative;">
            <p style="font-size: 2.5em; margin-bottom: 20px; text-align: center;">EOS connect</p>
            <p id="waiting_text" style="font-size: 1.5em; margin-bottom: 20px; text-align: center;">loading ...
            </p>
            <p id="waiting_error_text"
                style="font-size: 1.0em; font-weight: bold;  margin-bottom: 20px; text-align: center; color:rgb(241, 177, 0)">
                ...</p>
            <div
                style="border: 4px solid white; border-top: 4px solid gray; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto;">
            </div>
            
            <!-- Startup Log Access Button -->
            <button id="startup-logs-btn" onclick="if(typeof loggingManager !== 'undefined') { loggingManager.showLogsPanel(); }" 
                style="
                    background-color: rgba(255, 255, 255, 0.1);
                    color: white;
                    border: 2px solid rgba(255, 255, 255, 0.3);
                    border-radius: 8px;
                    padding: 12px 20px;
                    font-size: 0.9em;
                    cursor: pointer;
                    margin-top: 30px;
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.3s ease;
                    backdrop-filter: blur(10px);
                "
                onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.2)'; this.style.borderColor='rgba(255, 255, 255, 0.5)';"
                onmouseout="this.style.backgroundColor='rgba(255, 255, 255, 0.1)'; this.style.borderColor='rgba(255, 255, 255, 0.3)';"
                title="View system logs to see what's happening during startup">
                <i class="fas fa-file-alt"></i>
                Show Logs
            </button>
        </div>
        <div id="version_overlay"
            style="position: absolute; bottom: 10px; right: 10px; width: 100%; text-align: right; font-size: x-small;">
            EOS connect version: v00.00.00</div>
    </div>
    <div id="overlay_menu" style="display: none;">
        <div id="overlay_menu_content_wrapper" style="text-align: center; padding: 20px;">
            <p style="font-size: 1.8em; margin-bottom: 20px;">EOS connect</p>
            <hr>
            <p style="font-size: 1.3em; margin-bottom: 20px;" id="overlay_menu_head">Menu Overlay</p>
            <hr style="border-color: rgba(44, 44, 44, 0.596);">
            <p style="font-size: 1.2em; margin-bottom: 20px;" id="overlay_menu_content">This is a centered overlay menu.
            </p>
            <button id="overlay_menu_close" onclick="closeOverlayMenu(true)"
                style="padding: 10px 20px; font-size: 1em; background-color: #444; color: white; border: none; border-radius: 5px; cursor: pointer;">Close</button>
        </div>
    </div>
    <style>
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>

    <!-- Test Control Panel -->
    <div id="test_control_panel" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; z-index: 999; display: none; font-size: 12px;">
        <div style="margin-bottom: 10px; font-weight: bold; cursor: pointer;" onclick="toggleTestPanel()">ðŸ§ª Test Mode</div>
        <div id="test_controls" style="display: none;">
            <select id="test_scenario_select" onchange="switchTestScenario()" style="width: 100%; margin-bottom: 5px; padding: 2px; background: #333; color: white; border: 1px solid #666;">
                <option value="live">Central Test Data</option>
                <option value="single_evcc">Single EVCC</option>
                <option value="multi_evcc">Multiple EVCC</option>
                <option value="no_evcc">No EVCC</option>
            </select>
            <button onclick="refreshTestData()" style="width: 100%; padding: 3px; background: #444; color: white; border: 1px solid #666; cursor: pointer;">Refresh</button>
        </div>
    </div>

    <div class="container">
        <div class="top-boxes">
            <div class="top-box" id="current_controls_box">
                <div class="header"><i class="fa-solid fa-battery-full"></i> Current Controls
                    <span class="header_notification" id="current_header_left"
                        style="cursor: pointer;left: 10px;min-width: 20px;right: unset;">...</span>
                    <span class="header_notification" id="current_header_right"
                        style="cursor: pointer;min-width: 20px;">...</span>
                </div>
                <div class="content">
                    <table style="width: 100%; text-align: left;padding-top: 10px;">
                        <tr>
                            <th style="text-align: left;">Overall State</th>
                            <th style="text-align: right;" id="control_overall"></th>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <hr>
                            </td>
                        </tr>
                        <tr>
                            <td id="control_ac_charge_desc">AC Charge</td>
                            <td style="text-align: right;" id="control_ac_charge">--</td>
                        </tr>
                        <tr>
                            <td id="control_dc_charge_desc">DC Charge</td>
                            <td style="text-align: right;" id="control_dc_charge">--</td>
                        </tr>
                        <tr>
                            <td id="control_discharge_allowed_desc">Discharge Allowed</td>
                            <td style="text-align: right;" id="control_discharge_allowed">--</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="top-box">
                <div class="header"><i id="battery_icon_main"></i> Battery State
                    <span class="header_notification" id="battery_usable_capacity"
                        style="cursor: pointer;left: 10px;min-width: 20px;right: unset;">...</span>
                    <span class="header_notification" id="battery_soc" style="min-width: 20px;">...</span>
                </div>
                <div class="content">
                    <table style="width: 100%; text-align: left;padding-top: 10px;">
                        <tr id="next_charge_header">
                            <th style="text-align: left;">Next AC Charge</th>
                            <th style="text-align: right;" id="next_charge_time">... next charge time</th>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <hr>
                            </td>
                        </tr>
                        <tr id="next_charge_summary">
                            <td>Needed Energy</td>
                            <td colspan="2" style="text-align: right;"><span id="next_charge_amount">... kWh</span> /
                                <span id="next_charge_sum_price">... â‚¬</span>
                            </td>
                        </tr>
                        <tr id="next_charge_summary_2">
                            <td>Avg AC Charging Price</td>
                            <td colspan="2" style="text-align: right;" id="next_charge_avg_price">... kWh</td>
                        </tr>
                        <tr>
                            <td><i>Dynamic Max AC+DC Charge Power</i></td>
                            <td colspan="2" style="text-align: right;" id="current_max_charge_dyn">--</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="top-box">
                <div class="header"><i class="fa-solid fa-charging-station"></i> eCar Charging
                    <span class="header_notification" id="evcc_mode" style="left: 10px;right: unset;">...</span>
                    <span class="header_notification" id="evcc_state">...</span>
                </div>
                <div class="content" style="text-align: center;">
                    <span id="ecar_charging_table_off">no car connected</span>
                    <table style="width: 100%; text-align: left;padding-top: 10px;" id="ecar_charging_table_single">
                        <tr>
                            <!-- <th style="text-align: left;">Vehicle</th> -->
                            <th style="text-align: left; cursor: help;" colspan="2" title="name of vehicle in EVCC"><i
                                    class="fa-solid fa-car"></i> <span id="ecar_charging_name">...</span></th>
                            <!-- <th style="text-align: right;">SOC </th> -->
                            <th class="valueChange" style="text-align: right; cursor: help;" colspan="2"
                                title="eCar SOC"><span id="ecar_charging_soc">--.- %</span> <i
                                    class="fa-solid fa-car-battery"></i></th>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <hr>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: right; cursor: help;" class="valueChange" id="ecar_charging_odometer"
                                title="current vehicle mileage">--- km</td>
                            <td style="text-align: right;"><i class="fa-solid fa-gauge"> </i></td>
                            <td style="text-align: left; border-left-width: 1px; border-left-style: solid;"> <i
                                    class="fa-solid fa-road"></i></td>
                            <td style="text-align: left; cursor: help;" class="valueChange" style="text-align: right;"
                                id="ecar_charging_range" title="current vehicle range">--- km</td>
                        </tr>
                        <tr>
                            <td style="text-align: right; cursor: help;" class="valueChange" id="ecar_charging_charged"
                                title="already charged energy">0.00 kWh</td>
                            <td style="text-align: right;"><i class="fa-solid fa-right-long"> <i
                                        class="fa-solid fa-bolt"> </i></td>
                            <td style="text-align: left; border-left-width: 1px; border-left-style: solid;"> <i
                                    class="fa-solid fa-bolt"> </i> <i class="fa-solid fa-check"></i></td>
                            <td style="text-align: left; cursor: help;" class="valueChange"
                                id="ecar_charging_charged_remain" title="remaining energy to charge">0.00
                                kWh</td>
                        </tr>
                        <tr>
                            <td style="text-align: right; cursor: help;" class="valueChange" id="ecar_charging_duration"
                                title="current duration of charging">00:00</td>
                            <td style="text-align: right;"><i class="fa-solid fa-right-long"></i> <i
                                    class="fa-solid fa-stopwatch"></i> </td>
                            <td style="text-align: left; border-left-width: 1px; border-left-style: solid;"> <i
                                    class="fa-solid fa-clock"></i> <i class="fa-solid fa-check"></i></td>
                            <td style="text-align: left; cursor: help;" class="valueChange"
                                id="ecar_charging_duration_remain" title="remaining time until charging is done">00:00
                            </td>
                        </tr>
                    </table>
                    <table style="width: 100%; text-align: left;padding-top: 10px;" id="ecar_charging_table_multiple">
                        <!-- will be filled with multiple vehicles -->
                    </table>
                </div>
            </div>
            <div class="top-box">
                <div class="header"><i class="fa-solid fa-chart-pie"></i> Statistics
                    <span class="header_notification" id="statistics_header_left"
                        style="cursor: pointer;left: 10px;min-width: 20px;right: unset;">...</span>
                    <span class="header_notification" id="statistics_header_right" style="min-width: 20px;">...</span>
                </div>
                <div class="content">
                    <table style="width: 100%; text-align: left;padding-top: 10px;">
                        <tr>
                            <th style="text-align: left;">Expense (rest of the day)</th>
                            <th style="text-align: right;" id="expense_summary"> 0.00 â‚¬</th>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <hr>
                            </td>
                        </tr>
                        <tr>
                            <td>Income</td>
                            <td colspan="2" style="text-align: right;" id="income_summary">0.00 â‚¬</td>
                        </tr>
                        <tr>
                            <td>Feed In</td>
                            <td colspan="2" style="text-align: right;" id="feed_in_summary">0.0 kWh</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div class="bottom-boxes">
            <div class="left-box">
                <div class="header"><i class="fa-solid fa-chart-column"></i> Optimization
                    <span class="header_notification" id="timestamp_next_run"
                        style="left: 10px;right: unset;">00:00:00</span>
                    <span class="header_notification" id="mobileview_rotate"
                        style="right: 6.0em; background-color: inherit;"
                        title="Rotate your device to landscape for a better view">
                        <i class="fa-solid fa-mobile-screen-button"></i> <i class="fa-solid fa-rotate"></i>
                    </span>
                    <span class="header_notification" id="timestamp_last_run">00:00:00</span>
                </div>
                <div class="content">
                    <canvas id="energyChart"></canvas>
                </div>
            </div>
            <div class="right-box">
                <div class="header"><i class="fa-solid fa-calendar-days"></i><span id="load_schedule_header"> Schedule
                        next 24 hours</span></div>
                <div class="content">
                    <div id="discharge_scheduler" class="table">
                        <div class="table-header">
                            <div class="table-row">
                                <div class="table-cell">time</div>
                                <div class="table-cell">Control<br><i style="font-size: smaller;"></i>target state</i>
                                </div>
                                <div class="table-cell">Price<br><i style="font-size: smaller;">ct/kWh</i></div>
                                <div class="table-cell">Expense<br><i style="font-size: smaller;">â‚¬</i></div>
                                <div class="table-cell">Income<br><i style="font-size: smaller;">â‚¬</i></div>
                            </div>
                        </div>
                        <div class="table-row">
                            &nbsp;
                        </div>
                        <div class="table-body">
                            <div class="table-row">
                                <div class="table-cell">Data 1</div>
                                <div class="table-cell">Data 2</div>
                                <div class="table-cell">Data 3</div>
                                <div class="table-cell">Data 4</div>
                                <div class="table-cell">Data 5</div>
                            </div>
                            <div class="table-row">
                                <div class="table-cell">Data 5</div>
                                <div class="table-cell">Data 6</div>
                                <div class="table-cell">Data 7</div>
                                <div class="table-cell">Data 8</div>
                                <div class="table-cell">Data 9</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Load JavaScript modules in correct order -->
    <script src="js/constants.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/data.js"></script>
    <script src="js/bugreport.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/schedule.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/evcc.js"></script>
    <script src="js/battery.js"></script>
    <script src="js/logging.js"></script>
    <script src="js/main.js"></script>

</body>
</html>